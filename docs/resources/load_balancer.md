---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "stackit_load_balancer Resource - stackit"
subcategory: ""
description: |-
  Manages Load Balancer instances\n
  
  -> Environment supportTo set a custom API base URL, set STACKITLOADBALANCER_BASEURL environment variable
      \n
  Setting up openstack provider
  To automate the creation of load balancers, openstack can be used to setup the supporting infrastructure.
  To set up the provider, create a token on your project's Infrastructure API page
  and configure the provider as follows:
  ```terraform
  terraform {
      required_providers {
          stackit = {
              source = "github.com/schwarzit/stackit"
          }
          openstack = {
              source = "terraform-provider-openstack/openstack"
          }
      }
  }
  provider "stackit" {}
  provider "openstack" {
      tenantid        = "{OpenStack project ID}"
      tenantname      = "{OpenStack project name}"
      username        = "{Token name}"
      userdomainname = "portalmvp"
      password         = "{Token password}"
      region           = "RegionOne"
      auth_url         = "https://keystone.api.iaas.eu01.stackit.cloud/v3"
  }
  ```
  Setting up supporting infrastructure
  The example below uses openstack to create the network, router, a public IP address and a compute instance.
  ```terraform
  Create a network
  resource "openstacknetworkingnetworkv2" "example" {
    name = "examplenetwork"
  }
  Create a subnet
  resource "openstacknetworkingsubnetv2" "example" {
    name            = "examplesubnet"
    cidr            = "192.168.0.0/25"
    dnsnameservers = ["8.8.8.8"] // DNS is needed to reach the control plane
    networkid      = openstacknetworkingnetwork_v2.example.id
  }
  Get public network
  data "openstacknetworkingnetwork_v2" "public" {
    name = "floating-net"
  }
  Create a floating IP
  resource "openstacknetworkingfloatingipv2" "exampleip" {
    pool = data.openstacknetworkingnetwork_v2.public.name
  }
  Get flavor for instance
  data "openstackcomputeflavor_v2" "example" {
    name = "g1.1"
  }
  Create instance
  resource "openstackcomputeinstancev2" "example" {
    dependson      = [openstacknetworkingsubnetv2.example]
    name            = "exampleinstance"
    flavorid       = data.openstackcomputeflavorv2.example.id
    adminpass      = "example"
    securitygroups = ["default"]
  blockdevice {
      uuid                  = "4364cdb2-dacd-429b-803e-f0f7cfde1c24" // Ubuntu 22.04
      volumesize           = 32
      sourcetype           = "image"
      destinationtype      = "volume"
      deleteontermination = true
    }
  network {
      name = openstacknetworkingnetwork_v2.example.name
    }
  }
  Create a router and attach it to the public network
  resource "openstacknetworkingrouterv2" "examplerouter" {
    name                = "examplerouter"
    adminstateup      = "true"
    externalnetworkid = data.openstacknetworkingnetworkv2.public.id
  }
  Attach the subnet to the router
  resource "openstacknetworkingrouterinterfacev2" "exampleinterface" {
    routerid = openstacknetworkingrouterv2.examplerouter.id
    subnetid = openstacknetworkingsubnetv2.example.id
  }
  ```
---

# stackit_load_balancer (Resource)

Manages Load Balancer instances\n
<br />

-> __Environment support__<small>To set a custom API base URL, set <code>STACKIT_LOAD_BALANCER_BASEURL</code> environment variable </small>
	\n

## Setting up openstack provider

To automate the creation of load balancers, openstack can be used to setup the supporting infrastructure.

To set up the provider, create a token on your project's Infrastructure API page

and configure the provider as follows:


```terraform

terraform {
	required_providers {
		stackit = {
			source = "github.com/schwarzit/stackit"
		}
		openstack = {
			source = "terraform-provider-openstack/openstack"
		}
	}
}

provider "stackit" {}

provider "openstack" {
	tenant_id        = "{OpenStack project ID}"
	tenant_name      = "{OpenStack project name}"
	user_name        = "{Token name}"
	user_domain_name = "portal_mvp"
	password         = "{Token password}"
	region           = "RegionOne"
	auth_url         = "https://keystone.api.iaas.eu01.stackit.cloud/v3"
}

```

## Setting up supporting infrastructure

The example below uses openstack to create the network, router, a public IP address and a compute instance.


```terraform


# Create a network
resource "openstack_networking_network_v2" "example" {
  name = "example_network"
}

# Create a subnet
resource "openstack_networking_subnet_v2" "example" {
  name            = "example_subnet"
  cidr            = "192.168.0.0/25"
  dns_nameservers = ["8.8.8.8"] // DNS is needed to reach the control plane
  network_id      = openstack_networking_network_v2.example.id
}

# Get public network
data "openstack_networking_network_v2" "public" {
  name = "floating-net"
}

# Create a floating IP
resource "openstack_networking_floatingip_v2" "example_ip" {
  pool = data.openstack_networking_network_v2.public.name
}

# Get flavor for instance
data "openstack_compute_flavor_v2" "example" {
  name = "g1.1"
}

# Create instance
resource "openstack_compute_instance_v2" "example" {
  depends_on      = [openstack_networking_subnet_v2.example]
  name            = "example_instance"
  flavor_id       = data.openstack_compute_flavor_v2.example.id
  admin_pass      = "example"
  security_groups = ["default"]

  block_device {
    uuid                  = "4364cdb2-dacd-429b-803e-f0f7cfde1c24" // Ubuntu 22.04
    volume_size           = 32
    source_type           = "image"
    destination_type      = "volume"
    delete_on_termination = true
  }

  network {
    name = openstack_networking_network_v2.example.name
  }
}

# Create a router and attach it to the public network
resource "openstack_networking_router_v2" "example_router" {
  name                = "example_router"
  admin_state_up      = "true"
  external_network_id = data.openstack_networking_network_v2.public.id
}

# Attach the subnet to the router
resource "openstack_networking_router_interface_v2" "example_interface" {
  router_id = openstack_networking_router_v2.example_router.id
  subnet_id = openstack_networking_subnet_v2.example.id
}


```

## Example Usage

```terraform
# create a load balancer
resource "stackit_load_balancer" "example" {
  project_id = var.project_id
  name       = "example"
  target_pools = [{
    name        = "example-target-pool"
    target_port = 80
    targets = [{
      display_name = "example-target"
      ip_address   = openstack_compute_instance_v2.example.network.0.fixed_ip_v4
    }]
  }]
  listeners = [{
    display_name = "example-listener"
    port         = 80
    protocol     = "PROTOCOL_TCP"
    target_pool  = "example-target-pool"
  }]
  networks = [
    { network_id = openstack_networking_network_v2.example.id }
  ]
  external_address     = openstack_networking_floatingip_v2.example_ip.address
  private_network_only = false
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `listeners` (Attributes Set) The load balancers listeners. (see [below for nested schema](#nestedatt--listeners))
- `name` (String) Specifies the instance name. Changing this value requires the resource to be recreated.
- `networks` (Attributes Set) The load balancers networks. (see [below for nested schema](#nestedatt--networks))
- `project_id` (String) The project UUID. Changing this value requires the resource to be recreated.
- `target_pools` (Attributes Set) The load balancers target pools. (see [below for nested schema](#nestedatt--target_pools))

### Optional

- `acl` (Set of String) The load balancers ACLs.
- `external_address` (String) The external address of the instance.
- `private_address` (String) The private address of the load balancer.
- `private_network_only` (Boolean) Whether the load balancer is only accessible via private networks.
- `timeouts` (Attributes) (see [below for nested schema](#nestedatt--timeouts))

### Read-Only

- `id` (String) Specifies the resource ID

<a id="nestedatt--listeners"></a>
### Nested Schema for `listeners`

Required:

- `display_name` (String) The port the load balancer listens on.
- `port` (Number) The port the load balancer listens on [ 1 .. 65535 ].
- `protocol` (String) The protocol the load balancer listens on. Options: `PROTOCOL_TCP`, `PROTOCOL_UDP`, `PROTOCOL_TCP_PROXY`

Optional:

- `target_pool` (String) The target pool name.


<a id="nestedatt--networks"></a>
### Nested Schema for `networks`

Required:

- `network_id` (String) The network UUID.

Optional:

- `role` (String) The network role. only `ROLE_LISTENERS_AND_TARGETS` is supported.


<a id="nestedatt--target_pools"></a>
### Nested Schema for `target_pools`

Required:

- `name` (String) The target pool name.
- `target_port` (Number) The target port.
- `targets` (Attributes Set) The target pool targets. (see [below for nested schema](#nestedatt--target_pools--targets))

Optional:

- `health_check` (Attributes) (see [below for nested schema](#nestedatt--target_pools--health_check))

<a id="nestedatt--target_pools--targets"></a>
### Nested Schema for `target_pools.targets`

Required:

- `display_name` (String) The target display name.
- `ip_address` (String) The target IP address.


<a id="nestedatt--target_pools--health_check"></a>
### Nested Schema for `target_pools.health_check`

Required:

- `healthy_threshold` (Number) The healthy threshold.
- `interval` (String) The interval.
- `interval_jitter` (String) The interval jitter.
- `timeout` (String) The timeout.
- `unhealthy_threshold` (Number) The unhealthy threshold.



<a id="nestedatt--timeouts"></a>
### Nested Schema for `timeouts`

Optional:

- `create` (String)
- `delete` (String)


